"use strict";function firstDifferenceIndex(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){if(e.charAt(r)!==t.charAt(r)){return r}}return e.length===t.length?-1:n}function getReactRootElementInContainer(e){return e?e.nodeType===DOC_NODE_TYPE?e.documentElement:e.firstChild:null}function internalGetID(e){return e.getAttribute&&e.getAttribute(ATTR_NAME)||""}function mountComponentIntoNode(e,t,n,r,o){var a;if(ReactFeatureFlags.logTopLevelRenders){var i=e._currentElement.props.child,c=i.type;a="React mount: "+("string"==typeof c?c:c.displayName||c.name);console.time(a)}var u=ReactReconciler.mountComponent(e,n,null,ReactDOMContainerInfo(e,t),o,0);a&&console.timeEnd(a);e._renderedComponent._topLevelWrapper=e;ReactMount._mountImageIntoNode(u,t,e,r,n)}function batchedMountComponentIntoNode(e,t,n,r){var o=ReactUpdates.ReactReconcileTransaction.getPooled(!n&&ReactDOMFeatureFlags.useCreateElement);o.perform(mountComponentIntoNode,null,e,t,o,n,r);ReactUpdates.ReactReconcileTransaction.release(o)}function unmountComponentFromNode(e,t,n){ReactReconciler.unmountComponent(e,n);t.nodeType===DOC_NODE_TYPE&&(t=t.documentElement);for(;t.lastChild;){t.removeChild(t.lastChild)}}function hasNonRootReactChild(e){var t=getReactRootElementInContainer(e);if(t){var n=ReactDOMComponentTree.getInstanceFromNode(t);return!(!n||!n._hostParent)}}function nodeIsRenderedByOtherInstance(e){var t=getReactRootElementInContainer(e);return!(!t||!isReactNode(t)||ReactDOMComponentTree.getInstanceFromNode(t))}function isValidContainer(e){return!(!e||e.nodeType!==ELEMENT_NODE_TYPE&&e.nodeType!==DOC_NODE_TYPE&&e.nodeType!==DOCUMENT_FRAGMENT_NODE_TYPE)}function isReactNode(e){return isValidContainer(e)&&(e.hasAttribute(ROOT_ATTR_NAME)||e.hasAttribute(ATTR_NAME))}function getHostRootInstanceInContainer(e){var t=getReactRootElementInContainer(e),n=t&&ReactDOMComponentTree.getInstanceFromNode(t);return n&&!n._hostParent?n:null}function getTopLevelWrapperInContainer(e){var t=getHostRootInstanceInContainer(e);return t?t._hostContainerInfo._topLevelWrapper:null}var _prodInvariant=require("./reactProdInvariant"),DOMLazyTree=require("./DOMLazyTree"),DOMProperty=require("./DOMProperty"),React=require("react/lib/React"),ReactBrowserEventEmitter=require("./ReactBrowserEventEmitter"),ReactCurrentOwner=require("react/lib/ReactCurrentOwner"),ReactDOMComponentTree=require("./ReactDOMComponentTree"),ReactDOMContainerInfo=require("./ReactDOMContainerInfo"),ReactDOMFeatureFlags=require("./ReactDOMFeatureFlags"),ReactFeatureFlags=require("./ReactFeatureFlags"),ReactInstanceMap=require("./ReactInstanceMap"),ReactInstrumentation=require("./ReactInstrumentation"),ReactMarkupChecksum=require("./ReactMarkupChecksum"),ReactReconciler=require("./ReactReconciler"),ReactUpdateQueue=require("./ReactUpdateQueue"),ReactUpdates=require("./ReactUpdates"),emptyObject=require("fbjs/lib/emptyObject"),instantiateReactComponent=require("./instantiateReactComponent"),invariant=require("fbjs/lib/invariant"),setInnerHTML=require("./setInnerHTML"),shouldUpdateReactComponent=require("./shouldUpdateReactComponent"),warning=require("fbjs/lib/warning"),ATTR_NAME=DOMProperty.ID_ATTRIBUTE_NAME,ROOT_ATTR_NAME=DOMProperty.ROOT_ATTRIBUTE_NAME,ELEMENT_NODE_TYPE=1,DOC_NODE_TYPE=9,DOCUMENT_FRAGMENT_NODE_TYPE=11,instancesByReactRootID={},topLevelRootCounter=1,TopLevelWrapper=function(){this.rootID=topLevelRootCounter++};TopLevelWrapper.prototype.isReactComponent={};TopLevelWrapper.prototype.render=function(){return this.props.child};TopLevelWrapper.isReactTopLevelWrapper=!0;var ReactMount={TopLevelWrapper:TopLevelWrapper,_instancesByReactRootID:instancesByReactRootID,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r,o){ReactMount.scrollMonitor(r,function(){ReactUpdateQueue.enqueueElementInternal(e,t,n);o&&ReactUpdateQueue.enqueueCallbackInternal(e,o)});return e},_renderNewRootComponent:function(e,t,n,r){isValidContainer(t)?void 0:_prodInvariant("37");ReactBrowserEventEmitter.ensureScrollValueMonitoring();var o=instantiateReactComponent(e,!1);ReactUpdates.batchedUpdates(batchedMountComponentIntoNode,o,t,n,r);var a=o._instance.rootID;instancesByReactRootID[a]=o;return o},renderSubtreeIntoContainer:function(e,t,n,r){null!=e&&ReactInstanceMap.has(e)?void 0:_prodInvariant("38");return ReactMount._renderSubtreeIntoContainer(e,t,n,r)},_renderSubtreeIntoContainer:function(e,t,n,r){ReactUpdateQueue.validateCallback(r,"ReactDOM.render");React.isValidElement(t)?void 0:_prodInvariant("39","string"==typeof t?" Instead of passing a string like 'div', pass React.createElement('div') or <div />.":"function"==typeof t?" Instead of passing a class like Foo, pass React.createElement(Foo) or <Foo />.":null!=t&&void 0!==t.props?" This may be caused by unintentionally loading two independent copies of React.":"");var o,a=React.createElement(TopLevelWrapper,{child:t});if(e){var i=ReactInstanceMap.get(e);o=i._processChildContext(i._context)}else{o=emptyObject}var c=getTopLevelWrapperInContainer(n);if(c){var u=c._currentElement,p=u.props.child;if(shouldUpdateReactComponent(p,t)){var s=c._renderedComponent.getPublicInstance(),l=r&&function(){r.call(s)};ReactMount._updateRootComponent(c,a,o,n,l);return s}ReactMount.unmountComponentAtNode(n)}var R=getReactRootElementInContainer(n),d=R&&!!internalGetID(R),C=hasNonRootReactChild(n),m=d&&!c&&!C,T=ReactMount._renderNewRootComponent(a,n,m,o)._renderedComponent.getPublicInstance();r&&r.call(T);return T},render:function(e,t,n){return ReactMount._renderSubtreeIntoContainer(null,e,t,n)},unmountComponentAtNode:function(e){isValidContainer(e)?void 0:_prodInvariant("40");var t=getTopLevelWrapperInContainer(e);if(!t){hasNonRootReactChild(e),1===e.nodeType&&e.hasAttribute(ROOT_ATTR_NAME);return!1}delete instancesByReactRootID[t._instance.rootID];ReactUpdates.batchedUpdates(unmountComponentFromNode,t,e,!1);return!0},_mountImageIntoNode:function(e,t,n,r,o){isValidContainer(t)?void 0:_prodInvariant("41");if(r){var a=getReactRootElementInContainer(t);if(ReactMarkupChecksum.canReuseMarkup(e,a)){ReactDOMComponentTree.precacheNode(n,a);return}var i=a.getAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);a.removeAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);var c=a.outerHTML;a.setAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME,i);var u=e,p=firstDifferenceIndex(u,c),s=" (client) "+u.substring(p-20,p+20)+"\n (server) "+c.substring(p-20,p+20);t.nodeType===DOC_NODE_TYPE?_prodInvariant("42",s):void 0}t.nodeType===DOC_NODE_TYPE?_prodInvariant("43"):void 0;if(o.useCreateElement){for(;t.lastChild;){t.removeChild(t.lastChild)}DOMLazyTree.insertTreeBefore(t,e,null)}else{setInnerHTML(t,e);ReactDOMComponentTree.precacheNode(n,t.firstChild)}}};module.exports=ReactMount;