"use strict";var _require=require("./ReactChildFiber"),reconcileChildFibers=_require.reconcileChildFibers,reconcileChildFibersInPlace=_require.reconcileChildFibersInPlace,cloneChildFibers=_require.cloneChildFibers,_require2=require("./ReactPriorityLevel"),LowPriority=_require2.LowPriority,ReactTypeOfWork=require("./ReactTypeOfWork"),IndeterminateComponent=ReactTypeOfWork.IndeterminateComponent,FunctionalComponent=ReactTypeOfWork.FunctionalComponent,ClassComponent=ReactTypeOfWork.ClassComponent,HostContainer=ReactTypeOfWork.HostContainer,HostComponent=ReactTypeOfWork.HostComponent,CoroutineComponent=ReactTypeOfWork.CoroutineComponent,CoroutineHandlerPhase=ReactTypeOfWork.CoroutineHandlerPhase,YieldComponent=ReactTypeOfWork.YieldComponent,_require3=require("./ReactPriorityLevel"),NoWork=_require3.NoWork,OffscreenPriority=_require3.OffscreenPriority,_require4=require("./ReactFiberUpdateQueue"),createUpdateQueue=_require4.createUpdateQueue,addToQueue=_require4.addToQueue,addCallbackToQueue=_require4.addCallbackToQueue,mergeUpdateQueue=_require4.mergeUpdateQueue,ReactInstanceMap=require("./ReactInstanceMap");module.exports=function(e,r){function t(e,r,t){r.progressedChild=r.child;r.progressedPriority=t;if(e){e.progressedChild=r.progressedChild;e.progressedPriority=r.progressedPriority}}function n(e,r,t){var n=r.pendingWorkPriority;o(e,r,t,n)}function o(e,r,n,o){r.memoizedProps=null;e&&e.child===r.child?r.child=reconcileChildFibers(r,r.child,n,o):r.child=reconcileChildFibersInPlace(r,r.child,n,o);t(e,r,o)}function i(e,r){var t=r.type,o=r.pendingProps;if("function"==typeof t.shouldComponentUpdate&&null!==r.memoizedProps&&!t.shouldComponentUpdate(r.memoizedProps,o)){return c(e,r)}var i=t(o);n(e,r,i);return r.child}function a(e,t,n){var o=r(),i=o.scheduleDeferredWork;e.updateQueue=t;e.alternate&&(e.alternate.updateQueue=t);for(;;){(e.pendingWorkPriority===NoWork||e.pendingWorkPriority>=n)&&(e.pendingWorkPriority=n);e.alternate&&(e.alternate.pendingWorkPriority===NoWork||e.alternate.pendingWorkPriority>=n)&&(e.alternate.pendingWorkPriority=n);if(e.stateNode&&e.stateNode.containerInfo){var a=e.stateNode;i(a,n);return}if(!e.return){throw new Error("No root!")}e=e.return}}function u(e,r){var t=r.pendingProps;!t&&e&&(t=e.memoizedProps);var o=r.updateQueue,i=e?e.memoizedState:null,a=o?mergeUpdateQueue(o,i,t):i,u=r.stateNode;if(u){if(!("function"!=typeof u.shouldComponentUpdate||o&&o.isForced)&&null!==r.memoizedProps){u.props=r.memoizedProps;u.state=r.memoizedState;if(!u.shouldComponentUpdate(t,a)){return c(e,r)}}}else{var d=r.type;r.stateNode=u=new d(t);a=u.state||null;null!==a&&(r.updateQueue=createUpdateQueue(a));ReactInstanceMap.set(u,r);u.updater=C}u.props=t;u.state=a;var p=u.render();n(e,r,p);return r.child}function d(e,r){var t=r.pendingProps.children;if(r.pendingProps.hidden&&r.pendingWorkPriority!==OffscreenPriority){r.progressedPriority===OffscreenPriority&&(r.child=r.progressedChild);o(e,r,t,OffscreenPriority);r.child=e?e.child:null;return null}n(e,r,t);return r.child}function p(e,r){var t=r.type,o=r.pendingProps,i=t(o);if("object"==typeof i&&i&&"function"==typeof i.render){r.tag=ClassComponent;e&&(e.tag=ClassComponent);i=i.render()}else{r.tag=FunctionalComponent;e&&(e.tag=FunctionalComponent)}n(e,r,i);return r.child}function l(e,r){var t=r.pendingProps;if(!t){throw new Error("Should be resolved by now")}n(e,r,t.children)}function c(e,r){var n=r.pendingWorkPriority;cloneChildFibers(e,r);t(e,r,n);return r.child}function s(e,r){if(e){r.child=e.child;r.memoizedProps=e.memoizedProps;r.output=e.output}return null}function f(r,t,o){if(t.pendingWorkPriority===NoWork||t.pendingWorkPriority>o){return s(r,t)}t.progressedPriority===o&&(t.child=t.progressedChild);if((null===t.pendingProps||null!==t.memoizedProps&&t.pendingProps===t.memoizedProps)&&null===t.updateQueue){return c(r,t)}switch(t.tag){case IndeterminateComponent:return p(r,t);case FunctionalComponent:return i(r,t);case ClassComponent:return u(r,t);case HostContainer:n(r,t,t.pendingProps);return t.child?f(t.child.alternate,t.child,o):null;case HostComponent:t.stateNode&&e.beginUpdate&&e.beginUpdate(t.stateNode);return d(r,t);case CoroutineHandlerPhase:t.tag=CoroutineComponent;case CoroutineComponent:l(r,t);return t.child?f(t.child.alternate,t.child,o):t.child;case YieldComponent:return t.sibling?f(t.sibling.alternate,t.sibling,o):null;default:throw new Error("Unknown unit of work tag")}}var C={enqueueSetState:function(e,r){var t=ReactInstanceMap.get(e),n=t.updateQueue?addToQueue(t.updateQueue,r):createUpdateQueue(r);a(t,n,LowPriority)},enqueueReplaceState:function(e,r){var t=ReactInstanceMap.get(e),n=createUpdateQueue(r);n.isReplace=!0;a(t,n,LowPriority)},enqueueForceUpdate:function(e){var r=ReactInstanceMap.get(e),t=r.updateQueue||createUpdateQueue(null);t.isForced=!0;a(r,t,LowPriority)},enqueueCallback:function(e,r){var t=ReactInstanceMap.get(e),n=t.updateQueue?t.updateQueue:createUpdateQueue(null);addCallbackToQueue(n,r);t.updateQueue=n;t.alternate&&(t.alternate.updateQueue=n)}};return{beginWork:f}};