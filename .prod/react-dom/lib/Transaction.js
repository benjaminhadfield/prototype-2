"use strict";var _prodInvariant=require("./reactProdInvariant"),invariant=require("fbjs/lib/invariant"),OBSERVED_ERROR={},TransactionImpl={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers();this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[];this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(i,t,a,n,r,s,l,e){this.isInTransaction()?_prodInvariant("27"):void 0;var c,o;try{this._isInTransaction=!0;c=!0;this.initializeAll(0);o=i.call(t,a,n,r,s,l,e);c=!1}finally{try{if(c){try{this.closeAll(0)}catch(i){}}else{this.closeAll(0)}}finally{this._isInTransaction=!1}}return o},initializeAll:function(i){for(var t=this.transactionWrappers,a=i;a<t.length;a++){var n=t[a];try{this.wrapperInitData[a]=OBSERVED_ERROR;this.wrapperInitData[a]=n.initialize?n.initialize.call(this):null}finally{if(this.wrapperInitData[a]===OBSERVED_ERROR){try{this.initializeAll(a+1)}catch(i){}}}}},closeAll:function(i){this.isInTransaction()?void 0:_prodInvariant("28");for(var t=this.transactionWrappers,a=i;a<t.length;a++){var n,r=t[a],s=this.wrapperInitData[a];try{n=!0;s!==OBSERVED_ERROR&&r.close&&r.close.call(this,s);n=!1}finally{if(n){try{this.closeAll(a+1)}catch(i){}}}}this.wrapperInitData.length=0}};module.exports=TransactionImpl;