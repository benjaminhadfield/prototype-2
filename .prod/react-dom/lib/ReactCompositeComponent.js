"use strict";function StatelessComponent(e){}function warnIfInvalidElement(e,t){}function shouldConstruct(e){return!(!e.prototype||!e.prototype.isReactComponent)}function isPureComponent(e){return!(!e.prototype||!e.prototype.isPureReactComponent)}function measureLifeCyclePerf(e,t,n){if(0===t){return e()}ReactInstrumentation.debugTool.onBeginLifeCycleTimer(t,n);try{return e()}finally{ReactInstrumentation.debugTool.onEndLifeCycleTimer(t,n)}}var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign"),React=require("react/lib/React"),ReactComponentEnvironment=require("./ReactComponentEnvironment"),ReactCurrentOwner=require("react/lib/ReactCurrentOwner"),ReactErrorUtils=require("./ReactErrorUtils"),ReactInstanceMap=require("./ReactInstanceMap"),ReactInstrumentation=require("./ReactInstrumentation"),ReactNodeTypes=require("./ReactNodeTypes"),ReactReconciler=require("./ReactReconciler"),checkReactTypeSpec,emptyObject=require("fbjs/lib/emptyObject"),invariant=require("fbjs/lib/invariant"),shallowEqual=require("fbjs/lib/shallowEqual"),shouldUpdateReactComponent=require("./shouldUpdateReactComponent"),warning=require("fbjs/lib/warning"),CompositeTypes={ImpureClass:0,PureClass:1,StatelessFunctional:2};StatelessComponent.prototype.render=function(){var e=ReactInstanceMap.get(this)._currentElement.type,t=e(this.props,this.context,this.updater);warnIfInvalidElement(e,t);return t};var nextMountID=1,ReactCompositeComponent={construct:function(e){this._currentElement=e;this._rootNodeID=0;this._compositeType=null;this._instance=null;this._hostParent=null;this._hostContainerInfo=null;this._updateBatchNumber=null;this._pendingElement=null;this._pendingStateQueue=null;this._pendingReplaceState=!1;this._pendingForceUpdate=!1;this._renderedNodeType=null;this._renderedComponent=null;this._context=null;this._mountOrder=0;this._topLevelWrapper=null;this._pendingCallbacks=null;this._calledComponentWillUnmount=!1},mountComponent:function(e,t,n,o){this._context=o;this._mountOrder=nextMountID++;this._hostParent=t;this._hostContainerInfo=n;var i,r=this._currentElement.props,s=this._processContext(o),a=this._currentElement.type,p=e.getUpdateQueue(),c=shouldConstruct(a),l=this._constructComponent(c,r,s,p);if(c||null!=l&&null!=l.render){isPureComponent(a)?this._compositeType=CompositeTypes.PureClass:this._compositeType=CompositeTypes.ImpureClass}else{i=l;warnIfInvalidElement(a,i);null===l||l===!1||React.isValidElement(l)?void 0:_prodInvariant("105",a.displayName||a.name||"Component");l=new StatelessComponent(a);this._compositeType=CompositeTypes.StatelessFunctional}l.props=r;l.context=s;l.refs=emptyObject;l.updater=p;this._instance=l;ReactInstanceMap.set(l,this);var u=l.state;void 0===u&&(l.state=u=null);"object"!=typeof u||Array.isArray(u)?_prodInvariant("106",this.getName()||"ReactCompositeComponent"):void 0;this._pendingStateQueue=null;this._pendingReplaceState=!1;this._pendingForceUpdate=!1;var d;d=l.unstable_handleError?this.performInitialMountWithErrorHandling(i,t,n,e,o):this.performInitialMount(i,t,n,e,o);l.componentDidMount&&e.getReactMountReady().enqueue(l.componentDidMount,l);return d},_constructComponent:function(e,t,n,o){return this._constructComponentWithoutOwner(e,t,n,o)},_constructComponentWithoutOwner:function(e,t,n,o){var i=this._currentElement.type;return e?new i(t,n,o):i(t,n,o)},performInitialMountWithErrorHandling:function(e,t,n,o,i){var r,s=o.checkpoint();try{r=this.performInitialMount(e,t,n,o,i)}catch(a){o.rollback(s);this._instance.unstable_handleError(a);this._pendingStateQueue&&(this._instance.state=this._processPendingState(this._instance.props,this._instance.context));s=o.checkpoint();this._renderedComponent.unmountComponent(!0);o.rollback(s);r=this.performInitialMount(e,t,n,o,i)}return r},performInitialMount:function(e,t,n,o,i){var r=this._instance,s=0;if(r.componentWillMount){r.componentWillMount();this._pendingStateQueue&&(r.state=this._processPendingState(r.props,r.context))}void 0===e&&(e=this._renderValidatedComponent());var a=ReactNodeTypes.getType(e);this._renderedNodeType=a;var p=this._instantiateReactComponent(e,a!==ReactNodeTypes.EMPTY);this._renderedComponent=p;var c=ReactReconciler.mountComponent(p,o,t,n,this._processChildContext(i),s);return c},getHostNode:function(){return ReactReconciler.getHostNode(this._renderedComponent)},unmountComponent:function(e){if(this._renderedComponent){var t=this._instance;if(t.componentWillUnmount&&!t._calledComponentWillUnmount){t._calledComponentWillUnmount=!0;if(e){var n=this.getName()+".componentWillUnmount()";ReactErrorUtils.invokeGuardedCallback(n,t.componentWillUnmount.bind(t))}else{t.componentWillUnmount()}}if(this._renderedComponent){ReactReconciler.unmountComponent(this._renderedComponent,e);this._renderedNodeType=null;this._renderedComponent=null;this._instance=null}this._pendingStateQueue=null;this._pendingReplaceState=!1;this._pendingForceUpdate=!1;this._pendingCallbacks=null;this._pendingElement=null;this._context=null;this._rootNodeID=0;this._topLevelWrapper=null;ReactInstanceMap.remove(t)}},_maskContext:function(e){var t=this._currentElement.type,n=t.contextTypes;if(!n){return emptyObject}var o={};for(var i in n){o[i]=e[i]}return o},_processContext:function(e){var t=this._maskContext(e);return t},_processChildContext:function(e){var t,n=this._currentElement.type,o=this._instance;o.getChildContext&&(t=o.getChildContext());if(t){"object"!=typeof n.childContextTypes?_prodInvariant("107",this.getName()||"ReactCompositeComponent"):void 0;for(var i in t){i in n.childContextTypes?void 0:_prodInvariant("108",this.getName()||"ReactCompositeComponent",i)}return _assign({},e,t)}return e},_checkContextTypes:function(e,t,n){},receiveComponent:function(e,t,n){var o=this._currentElement,i=this._context;this._pendingElement=null;this.updateComponent(t,o,e,i,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement?ReactReconciler.receiveComponent(this,this._pendingElement,e,this._context):null!==this._pendingStateQueue||this._pendingForceUpdate?this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context):this._updateBatchNumber=null},updateComponent:function(e,t,n,o,i){var r=this._instance;null==r?_prodInvariant("136",this.getName()||"ReactCompositeComponent"):void 0;var s,a=!1;if(this._context===i){s=r.context}else{s=this._processContext(i);a=!0}var p=t.props,c=n.props;t!==n&&(a=!0);a&&r.componentWillReceiveProps&&r.componentWillReceiveProps(c,s);var l=this._processPendingState(c,s),u=!0;this._pendingForceUpdate||(r.shouldComponentUpdate?u=r.shouldComponentUpdate(c,l,s):this._compositeType===CompositeTypes.PureClass&&(u=!shallowEqual(p,c)||!shallowEqual(r.state,l)));this._updateBatchNumber=null;if(u){this._pendingForceUpdate=!1;this._performComponentUpdate(n,c,l,s,e,i)}else{this._currentElement=n;this._context=i;r.props=c;r.state=l;r.context=s}},_processPendingState:function(e,t){var n=this._instance,o=this._pendingStateQueue,i=this._pendingReplaceState;this._pendingReplaceState=!1;this._pendingStateQueue=null;if(!o){return n.state}if(i&&1===o.length){return o[0]}for(var r=_assign({},i?o[0]:n.state),s=i?1:0;s<o.length;s++){var a=o[s];_assign(r,"function"==typeof a?a.call(n,r,e,t):a)}return r},_performComponentUpdate:function(e,t,n,o,i,r){var s,a,p,c=this._instance,l=Boolean(c.componentDidUpdate);if(l){s=c.props;a=c.state;p=c.context}c.componentWillUpdate&&c.componentWillUpdate(t,n,o);this._currentElement=e;this._context=r;c.props=t;c.state=n;c.context=o;this._updateRenderedComponent(i,r);l&&i.getReactMountReady().enqueue(c.componentDidUpdate.bind(c,s,a,p),c)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,o=n._currentElement,i=this._renderValidatedComponent(),r=0;if(shouldUpdateReactComponent(o,i)){ReactReconciler.receiveComponent(n,i,e,this._processChildContext(t))}else{var s=ReactReconciler.getHostNode(n);ReactReconciler.unmountComponent(n,!1);var a=ReactNodeTypes.getType(i);this._renderedNodeType=a;var p=this._instantiateReactComponent(i,a!==ReactNodeTypes.EMPTY);this._renderedComponent=p;var c=ReactReconciler.mountComponent(p,e,this._hostParent,this._hostContainerInfo,this._processChildContext(t),r);this._replaceNodeWithMarkup(s,c,n)}},_replaceNodeWithMarkup:function(e,t,n){ReactComponentEnvironment.replaceNodeWithMarkup(e,t,n)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e,t=this._instance;e=t.render();return e},_renderValidatedComponent:function(){var e;if(this._compositeType!==CompositeTypes.StatelessFunctional){ReactCurrentOwner.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{ReactCurrentOwner.current=null}}else{e=this._renderValidatedComponentWithoutOwnerOrContext()}null===e||e===!1||React.isValidElement(e)?void 0:_prodInvariant("109",this.getName()||"ReactCompositeComponent");return e},attachRef:function(e,t){var n=this.getPublicInstance();null==n?_prodInvariant("110"):void 0;var o=t.getPublicInstance(),i=n.refs===emptyObject?n.refs={}:n.refs;i[e]=o},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return this._compositeType===CompositeTypes.StatelessFunctional?null:e},_instantiateReactComponent:null};module.exports=ReactCompositeComponent;